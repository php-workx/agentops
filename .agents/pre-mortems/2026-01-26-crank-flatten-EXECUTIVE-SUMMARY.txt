================================================================================
EXECUTIVE SUMMARY: OPS FAILURE SIMULATION - CRANK FLATTEN PLAN
================================================================================

DATE: 2026-01-26
PLAN: Flatten skill nesting to reduce context from 24K to 12K tokens
SIMULATION: 12 parallel agents + batch vibe at end
STATUS: NOT READY AS PROPOSED

================================================================================
KEY FINDINGS
================================================================================

THREE CRITICAL FAILURES IDENTIFIED:

1. RATE LIMIT CASCADE (12 agents fire simultaneously)
   - Probability: HIGH
   - Impact: All 12 agents stall for 5+ minutes
   - Token Cost: +70K wasted (defeats 12K savings immediately)
   - Recovery: 30 minutes minimum, full crank restart
   - Root Cause: No rate limit coordination across parallel agents

2. SILENT DEFECT PROPAGATION (batch vibe too late)
   - Probability: HIGH
   - Impact: Early issues contaminate later issues
   - Token Cost: +180 min recovery time, +70K tokens
   - Recovery: Bisect, revert 4+ issues, re-run validation
   - Root Cause: Moving validation from BEFORE merge to AFTER merge

3. BROKEN MAIN BRANCH (issues merge without validation)
   - Probability: MEDIUM
   - Impact: Downstream users pull broken code
   - Token Cost: Emergency hotfix, +50K tokens
   - Recovery: Git revert, force push, communication
   - Root Cause: Validation gate removed before merge

================================================================================
SEVERITY MATRIX
================================================================================

CRITICAL: 3 failures
- Rate limit cascade
- Silent defect propagation  
- Broken main branch

HIGH: 5 failures
- GitHub API rate limiting
- Module contamination detected late
- Mayor goes blind (no progress signals)
- Module contamination from different issues
- Architecture violation created as debt

MEDIUM: 4 failures
- Debugging difficulty (multi-issue vibe reports)
- No circuit breaker for early termination
- Crank hidden stall (no heartbeat signal)
- Token savings never materialize

LOW: 0 failures

TOTAL OPERATIONAL RISK: UNACCEPTABLE

================================================================================
QUANTIFIED IMPACT
================================================================================

Worst-Case Scenario:
┌─────────────┬─────────────┬──────────────────────────────────┐
│ Event       │ Time Cost   │ Token Cost                       │
├─────────────┼─────────────┼──────────────────────────────────┤
│ Rate limit  │ 30 min      │ +70K wasted, plan savings lost  │
│ + Revert    │ +60 min     │ +20K recovery validation         │
│ + Re-run    │ +180 min    │ +60K re-running all 12 issues   │
│ + Debug     │ +30 min     │ +10K forensics                   │
├─────────────┼─────────────┼──────────────────────────────────┤
│ TOTAL       │ 300 min     │ 160K tokens (vs 12K savings)    │
│             │ (5 hours)   │ NET: -148K tokens lost           │
└─────────────┴─────────────┴──────────────────────────────────┘

Best-Case Scenario (everything works):
- 12K tokens saved
- Crank completes in 360 minutes
- But: No path to this case without removing all validation

Expected-Case Scenario (1 failure occurs):
- Rate limit cascade OR defect propagation happens
- +90 minutes recovery time (lost epic time)
- +50K tokens (defeats savings entirely)
- User frustrated with "crank got stuck"

================================================================================
COMPARISON: THREE OPTIONS
================================================================================

OPTION 1: Current Implementation (24K tokens)
├─ Validation: Per-issue (safe, early detection)
├─ Token Usage: 24K
├─ Risk Level: LOW
├─ MTTR if fails: <30 min
└─ Recommendation: STABLE, don't change

OPTION 2: Original Proposal - Flatten (12K tokens)
├─ Validation: Batch at end (risky, late detection)
├─ Token Usage: 12K (50% savings)
├─ Risk Level: CRITICAL (3 failure modes)
├─ MTTR if fails: 3+ hours
├─ Effort to make safe: 2-3 weeks
└─ Recommendation: DO NOT IMPLEMENT

OPTION 3: Hybrid Validation (15K tokens) *** RECOMMENDED ***
├─ Validation: Fast per-issue gate + comprehensive post-mortem
├─ Token Usage: 15K (37.5% savings)
├─ Risk Level: LOW (same gates, deferred expensive checks)
├─ MTTR if fails: <30 min
├─ Effort to implement: 4 hours
└─ Recommendation: IMPLEMENT THIS INSTEAD

================================================================================
ARCHITECTURAL PRINCIPLE VIOLATED
================================================================================

The Brownian Ratchet (from OLYMPUS-ARCHITECTURE.md):

    CHAOS (parallel work) 
          + 
    FILTER (validation gate)
          + 
    RATCHET (permanent merge)
       = 
    PROGRESS

Current Design:  chaos → FILTER → ratchet ✓ (safe)
Proposed Design: chaos → ratchet → FILTER ✗ (unsafe)

Moving the filter after the ratchet breaks the safety contract.
Once code merges, it's permanent. Validation can't prevent bad merges.

================================================================================
HYBRID VALIDATION: HOW IT WORKS
================================================================================

                        CURRENT                 HYBRID
                        -------                 ------

Issue #1: implement   [30 min]
          vibe (full) [5 min]  ----------     [2 min] fast vibe
          merge       [1 min]                 [1 min]

Issue #2: implement   [30 min]
          vibe (full) [5 min]  ----------     [2 min] fast vibe
          merge       [1 min]                 [1 min]

...

Issue #12: implement  [30 min]
           vibe (full) [5 min] ----------     [2 min] fast vibe
           merge      [1 min]                [1 min]

[All 12 complete]     [Total: 24K tokens]    [Total: 15K tokens]
                                             
                      Post-mortem:            Post-mortem:
                      [Optional]              [Batch comprehensive vibe: 6K]
                      [Not typically run]     [Extra validation, not gating]
                      
                      ────────────────────────────────────────────
                      Safety: Full gate      Safety: Full gate (fast)
                      Tokens: 24K            Tokens: 15K + 6K (optional)
                                             Savings: 37.5% (safe)

Fast Vibe Checks (per-issue gate):
  ✓ Compilation errors
  ✓ Type mismatches
  ✓ Tests pass
  ✓ Secrets detection (security gate)
  ✗ Architecture review (deferred)
  ✗ Code complexity (deferred)

Comprehensive Vibe Checks (post-mortem audit):
  ✓ All critical checks from fast vibe
  ✓ Architecture violations
  ✓ Complexity analysis
  ✓ Accessibility audit
  ✓ Code quality
  ✓ Security deep dive

================================================================================
TOKEN BUDGET COMPARISON
================================================================================

Current (24K):
├─ Implement (12 issues × 30 min): 12K tokens
├─ Per-issue vibe (12 × full): 9.6K tokens
└─ Cleanup: 2.4K tokens

Original Proposal (12K):
├─ Implement: 12K tokens
├─ Batch vibe (end): 2K tokens
├─ But requires recovery: +70K on failure = NET LOSS
└─ Actually unsafe at 12K

Hybrid (15K):
├─ Implement: 12K tokens
├─ Per-issue fast vibe (12 × 100 tokens): 1.2K tokens
├─ Cleanup: 0.6K tokens
└─ Optional post-mortem comprehensive: +6K (separate workflow)

================================================================================
APPROVAL CRITERIA
================================================================================

If you still want the original proposal (12K tokens), it MUST satisfy:

□ RATE LIMIT SPECIFICATION
  - Prove 12 agents fire simultaneously with no 429s
  - Provide tested limits for Claude API, GitHub, Anthropic
  - Implement exponential backoff with coordination

□ SILENT MERGE PREVENTION
  - Show batch vibe catches all compile-time issues
  - Provide recovery procedure if issues cross-contaminate
  - Document circuit breaker for pre-merge abort

□ PROGRESS REPORTING
  - Add heartbeat signals every issue completion
  - Show user can monitor progress in real-time
  - Document feedback frequency

□ TESTING SCENARIOS
  - Run on 12-issue epic with intentional bugs
  - Verify batch vibe catches them
  - Measure recovery time

□ OPERATIONAL PLAYBOOK
  - Document emergency recovery procedures
  - Provide git commands for safe revert
  - Walk through 2 failure scenarios

EFFORT: 2-3 weeks of hardening
OUTCOME: Possibly achievable, but complex

ALTERNATIVELY: Implement hybrid validation (RECOMMENDED)
EFFORT: 4 hours
OUTCOME: Achieves safe savings immediately

================================================================================
RECOMMENDATION
================================================================================

DO NOT IMPLEMENT original flatten proposal without 2-3 weeks of safety 
hardening and 5 approval criteria addressed.

INSTEAD: Implement hybrid validation strategy

  1. Add --fast mode to vibe skill (run only critical checks)
  2. Update crank to use fast vibe instead of comprehensive vibe
  3. Keep comprehensive vibe for post-mortem (optional, not gating)
  4. Achieves 37.5% token savings (15K vs 24K)
  5. Maintains safety gates (no CRITICAL risk)
  6. Recovery time <30 min if anything breaks
  7. Effort: 4 hours implementation + testing
  8. Timeline: Can be done in 1-2 days

The 12.5% difference in savings (50% → 37.5%) is a reasonable trade-off 
for eliminating CRITICAL operational risks.

================================================================================
DOCUMENTS CREATED
================================================================================

This analysis consists of 3 detailed reports:

1. 2026-01-26-crank-flatten-ops-failures.md (THIS DOCUMENT)
   → Main failure analysis with severity ratings
   → Cascade scenarios and cost analysis
   → Recommended mitigations

2. 2026-01-26-crank-flatten-technical-details.md
   → Deep technical root cause analysis
   → Rate limit mechanics and code examples
   → Why current FIRE loop handles 4 agents safely but 12 agents fails

3. 2026-01-26-crank-flatten-recommendations.md
   → Hybrid validation strategy (37.5% savings, LOW risk)
   → Implementation roadmap (4 hours)
   → Approval criteria for original proposal

================================================================================
