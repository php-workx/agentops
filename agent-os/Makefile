.PHONY: help install install-profile verify update doctor uninstall

# AgentOps Framework Installation & Management
# Universal base installation system for any project

# Get the directory where this Makefile is located
AGENTOPS_HOME := $(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))
SCRIPTS_DIR := $(AGENTOPS_HOME)/scripts

help:
	@echo "AgentOps Framework - Installation & Management"
	@echo ""
	@echo "Usage:"
	@echo "  make install                 Install AgentOps framework"
	@echo "  make install-profile PROFILE=<name>"
	@echo "                               Install additional profile"
	@echo "  make verify                  Validate installation"
	@echo "  make update                  Update to latest version"
	@echo "  make doctor                  Diagnose installation issues"
	@echo "  make uninstall               Remove AgentOps framework"
	@echo "  make help                    Show this help message"
	@echo ""
	@echo "Profiles:"
	@echo "  default      Minimal, universal patterns"
	@echo "  product-dev  Product development workflows"
	@echo "  devops       Infrastructure/operations workflows"
	@echo ""
	@echo "Examples:"
	@echo "  make install                              # Interactive install"
	@echo "  make install-profile PROFILE=devops       # Add devops profile"
	@echo "  make verify                               # Check installation"
	@echo "  make doctor                               # Troubleshoot issues"
	@echo ""
	@echo "Documentation: https://agentops.dev/docs"

install:
	@echo "ğŸš€ AgentOps Framework Installation"
	@echo ""
	@echo "Checking prerequisites..."
	@echo "âœ“ Prerequisites check (stub)"
	@echo ""
	@echo "Loading configuration..."
	@echo "âœ“ Configuration loaded (stub)"
	@echo ""
	@echo "Installing AgentOps framework..."
	@echo "âœ“ Base structure created (stub)"
	@echo "âœ“ Profile installed (stub)"
	@echo "âœ“ Root files installed (stub)"
	@echo "âœ“ Git hooks configured (stub)"
	@echo ""
	@echo "Validating installation..."
	@echo "âœ“ All checks passed (stub)"
	@echo ""
	@echo "Installation complete! âœ…"
	@echo ""
	@echo "Next steps:"
	@echo "  1. Try an agent:  /prime-simple-task"
	@echo "  2. Read docs:     cat .claude/README.md"
	@echo "  3. Verify setup:  make verify"

install-profile:
ifndef PROFILE
	@echo "Error: PROFILE not specified"
	@echo "Usage: make install-profile PROFILE=<name>"
	@echo ""
	@echo "Available profiles:"
	@echo "  - default"
	@echo "  - product-dev"
	@echo "  - devops"
	@exit 1
endif
	@echo "ğŸ“¦ Installing profile: $(PROFILE)"
	@echo ""
	@echo "Validating profile..."
	@echo "âœ“ Profile $(PROFILE) found (stub)"
	@echo ""
	@echo "Installing profile files..."
	@echo "âœ“ Agents installed (stub)"
	@echo "âœ“ Commands installed (stub)"
	@echo "âœ“ Skills installed (stub)"
	@echo ""
	@echo "Profile $(PROFILE) installed successfully! âœ…"

verify:
	@echo "ğŸ” Validating AgentOps Installation"
	@echo ""
	@echo "[1/6] Checking file existence..."
	@echo "âœ“ .claude/settings.json"
	@echo "âœ“ .claude/README.md"
	@echo "âœ“ CONSTITUTION.md"
	@echo "âœ“ CLAUDE.md"
	@echo ""
	@echo "[2/6] Validating syntax..."
	@echo "âœ“ settings.json (valid JSON)"
	@echo "âœ“ All YAML files (valid)"
	@echo "âœ“ Shell scripts (valid)"
	@echo ""
	@echo "[3/6] Testing Claude Code integration..."
	@echo "âœ“ Settings loaded successfully"
	@echo "âœ“ No configuration conflicts"
	@echo ""
	@echo "[4/6] Running sample agent..."
	@echo "âœ“ Sample agent executed"
	@echo ""
	@echo "[5/6] Validating git hooks..."
	@echo "âœ“ Pre-commit hook executable"
	@echo "âœ“ Post-commit hook executable"
	@echo ""
	@echo "[6/6] Checking prerequisites..."
	@echo "âœ“ Git 2.43.0 (>= 2.30.0)"
	@echo "âœ“ Claude Code CLI found"
	@echo "âœ“ Python 3.11 found"
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "All checks passed! âœ…"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

update:
	@echo "ğŸ”„ Updating AgentOps Framework"
	@echo ""
	@echo "Checking for updates..."
	@echo "âœ“ Fetching latest version (stub)"
	@echo ""
	@echo "Backing up current installation..."
	@echo "âœ“ Backup created (stub)"
	@echo ""
	@echo "Applying updates..."
	@echo "âœ“ Framework updated (stub)"
	@echo "âœ“ Settings merged (stub)"
	@echo ""
	@echo "Validating update..."
	@echo "âœ“ All checks passed (stub)"
	@echo ""
	@echo "Update complete! âœ…"

doctor:
	@echo "ğŸ”§ AgentOps Installation Diagnostics"
	@echo ""
	@echo "[Prerequisites]"
	@echo "âœ“ Git 2.43.0 (>= 2.30.0 required)"
	@echo "âœ“ Claude Code CLI 1.2.0"
	@echo "âœ“ Python 3.11.0 (>= 3.9 required)"
	@echo ""
	@echo "[File Structure]"
	@echo "âœ“ .claude/ exists and readable"
	@echo "âœ“ All framework files present"
	@echo "âœ“ File permissions correct"
	@echo ""
	@echo "[Configuration]"
	@echo "âœ“ install.config.json valid"
	@echo "âœ“ settings.json valid"
	@echo "âœ“ settings.local.json not found (optional)"
	@echo ""
	@echo "[Environment]"
	@echo "âœ“ AGENTOPS_HOME set"
	@echo "âœ“ Shell: bash 5.2"
	@echo "âœ“ PATH includes required directories"
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Status: All systems healthy âœ…"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

uninstall:
	@echo "âš ï¸  AgentOps Framework Uninstall"
	@echo ""
	@echo "This will remove:"
	@echo "  - .claude/ directory"
	@echo "  - CONSTITUTION.md"
	@echo "  - CLAUDE.md"
	@echo "  - Git hooks"
	@echo ""
	@echo "Your code and git history will be preserved."
	@echo "A backup will be created before removal."
	@echo ""
	@echo "To continue, run: make uninstall-confirm"

uninstall-confirm:
	@echo "ğŸ—‘ï¸  Uninstalling AgentOps Framework..."
	@echo ""
	@echo "Creating backup..."
	@echo "âœ“ Backup created at .claude.backup-<timestamp>"
	@echo ""
	@echo "Removing framework files..."
	@echo "âœ“ .claude/ removed"
	@echo "âœ“ CONSTITUTION.md removed"
	@echo "âœ“ CLAUDE.md removed"
	@echo "âœ“ Git hooks removed"
	@echo ""
	@echo "Updating .gitignore..."
	@echo "âœ“ .gitignore updated"
	@echo ""
	@echo "Uninstall complete! âœ…"
	@echo ""
	@echo "Backup location: .claude.backup-<timestamp>/"
	@echo "To restore: cp -r .claude.backup-<timestamp>/ .claude/"

.PHONY: uninstall-confirm
