version: 2
project_name: ao

builds:
  - id: ao
    dir: cli
    main: ./cmd/ao
    binary: ao
    goos:
      - darwin
      - linux
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w -X main.version={{ .Version }}

archives:
  - id: ao
    name_template: ao-{{ .Os }}-{{ .Arch }}
    wrap_in_directory: false

checksum:
  name_template: checksums.txt
  algorithm: sha256

changelog:
  sort: asc
  groups:
    - title: "ğŸš€ New Features"
      regexp: '^.*?feat(\([[:word:]]+\))??!?:.+$'
      order: 0
    - title: "ğŸ› Bug Fixes"
      regexp: '^.*?fix(\([[:word:]]+\))??!?:.+$'
      order: 1
    - title: "ğŸ“š Documentation"
      regexp: '^.*?docs(\([[:word:]]+\))??!?:.+$'
      order: 2
    - title: "ğŸ”§ Other"
      order: 999
  filters:
    exclude:
      - '^Merge'

release:
  header: |
    `brew upgrade agentops` Â· [checksums](https://github.com/boshu2/agentops/releases/download/{{ .Tag }}/checksums.txt) Â· [verify provenance](https://docs.github.com/en/actions/security-for-github-actions/using-artifact-attestations/using-artifact-attestations-to-establish-provenance-for-builds)
  footer: |
    **Full Changelog**: https://github.com/boshu2/agentops/compare/{{ .PreviousTag }}...{{ .Tag }}

    This release was planned, built, and validated by AgentOps agents. The flywheel turns.

brews:
  - name: agentops
    directory: Formula
    homepage: https://github.com/boshu2/agentops
    description: Knowledge Flywheel CLI for AI-assisted development
    license: MIT
    install: |
      bin.install "ao"
    test: |
      system "#{bin}/ao version"
    repository:
      owner: boshu2
      name: homebrew-agentops
      branch: main
      token: "{{ .Env.HOMEBREW_TAP_GITHUB_TOKEN }}"
